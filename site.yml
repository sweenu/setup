---
- hosts: localhost
  pre_tasks:
    - name: Query present graphics cards
      shell: lspci | grep -e VGA -e 3D
      register: present_gpus
      changed_when: false
      tags:
        - intel_graphics
        - nvidia
        - display

    - name: Set facts for GPUs
      set_fact:
        nvidia_gpu_present: "{{ 'nvidia' in present_gpus.stdout|lower }}"
        intel_gpu_present: "{{ 'intel' in present_gpus.stdout|lower }}"
      tags:
        - intel_graphics
        - nvidia
        - display

  roles:
    - role: time
      tags: time

    - role: locale
      tags: locale

    - role: linux_console
      tags: linux_console

    - role: hostname
      tags: hostname

    - role: sudoers
      tags: sudoers

    - role: yaourt
      tags: yaourt

    - role: pacman
      tags: pacman

    - role: fonts
      tags: fonts

    - role: neovim
      tags: neovim

    - role: oni
      tags: oni

    - role: ssh
      tags: ssh

    - role: networkmanager
      tags: networkmanager

    - role: lightdm
      tags: lightdm

    - role: xorg
      tags:
        - xorg
        - display

    - role: nvidia
      when: nvidia_gpu_present
      tags:
        - nvidia
        - display

    - role: intel_graphics
      when: intel_gpu_present
      tags:
        - intel_graphics
        - display

    - role: backlight
      tags: backlight

    - role: gnome-keyring
      tags: gnome-keyring

    - role: bluetooth
      tags: bluetooth

    - role: tlp
      tags: tlp
      when: ansible_form_factor == 'Laptop'

    - role: cups
      tags: cups

    - role: env-vars
      tags: env-vars

    - role: xdg-user-dirs
      tags: xdg-user-dirs

    - role: pulseaudio
      tags: pulseaudio

    - role: mimeapps
      tags: mimeapps

    - role: fish
      tags: fish

    - role: clipster
      tags: clipster

    - role: qtile
      tags: qtile

    - role: spotify
      tags: spotify

    - role: deepin-tools
      tags: deepin-tools

    - role: dunst
      tags: dunst

    - role: termite
      tags: termite

    # - role: tunnelbear
    #   tags: tunnelbear

    - role: kdeconnect
      tags: kdeconnect

    - role: ranger
      tags: ranger

    - role: redshift
      tags: redshift

    - role: gtk3
      tags: gtk3

    - role: vimiv
      tags: vimiv

    - role: taskwarrior
      tags: taskwarrior

    - role: git
      tags: git

    - role: ansible
      tags: ansible

    - role: docker
      tags: docker

    - role: firefox
      tags: firefox

    - role: others
      tags: others
